<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/me319/libs/highlight/github.min.css"> <link rel=stylesheet  href="/me319/css/franklin.css"> <link rel=stylesheet  href="/me319/css/poole_hyde.css"> <link rel=stylesheet  href="/me319/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 968px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/me319/assets/c.svg"> <title>Part I L4 - Microcontroller Peripherals</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <br> <img src="/me319/assets/KuwaitUniversityLogoTextLight.svg" style="width: 200px; height: auto; display: inline"> <h1 style="font-size:2em; opacity: 0.75;"><a href="/me319/">ME 319</a></h1> <p class=lead >Mechatronics</p> </div> <script> function hidePart(part_div) { var x = document.getElementById(part_div); if (x.style.display === "none") { x.style.display = "block"; } else { x.style.display = "none"; } } </script> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/me319/">Home</a> <a class="sidebar-nav-item " href="/me319/videos/">Lecture Videos</a> <a class="sidebar-nav-item " href="https://alsaibie.github.io/embeddedcpp_course">Embedded C/C++ Mini-Course</a> <a class="sidebar-nav-item " href="/me319/lab_assignments/">Lab Assignments</a> <br> <small style="text-transform: uppercase; font-size: 0.75em">Class Lectures</small> <div class=part  onclick="hidePart('part1_div')">I The Brain</div> <div id=part1_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_i/lecture0/"><b>L0</b> - <em>Introduction</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture1/"><b>L1</b> - <em>Microcontroller Architecture</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture2/"><b>L2</b> - <em>Digital Arithmetic</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture3/"><b>L3</b> - <em>Digital Logic</em></a> <a class="sidebar-nav-item active" href="/me319/part_i/lecture4/"><b>L4</b> - <em>Microcontroller Peripherals</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture5/"><b>L5</b> - <em>GPIO</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture6/"><b>L6</b> - <em>Timers</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture7/"><b>L7</b> - <em>Interrupts</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture8/"><b>L8</b> - <em>Communication</em></a> </div> <div class=part  onclick="hidePart('part2_div')">II The Cells</div> <div id=part2_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_ii/lecture1/"><b>L1</b> - <em>Passive Circuits</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture2/"><b>L2</b> - <em>Switching Semiconductors</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture3/"><b>L3</b> - <em>Operational Amplifiers</em></a> </div> <div class=part  onclick="hidePart('part3_div')">III The Senses</div> <div id=part3_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iii/lecture1/"><b>L1</b> - <em>Signal Conditioning and Filtering</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture2/"><b>L2</b> - <em>Sensor Charactersitics</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture3/"><b>L3</b> - <em>Survey of Sensors</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture4/"><b>L4</b> - <em>Motion Sensors</em></a> </div> <div class=part  onclick="hidePart('part4_div')">IV The Muscles</div> <div id=part4_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iv/lecture1/"><b>L1</b> - <em>DC Motors</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture2/"><b>L2</b> - <em>Practical Feedback Control</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture4/"><b>L3</b> - <em>Stepper Motors</em></a> </div> <div class=part  onclick="hidePart('part5_div')">V The Body</div> <div id=part5_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_v/lecture1/"><b>L1</b> - <em>System Integration</em></a> </div> </nav> <p>&copy; Ali AlSaibie, PhD.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=microcontroller_peripherals ><a href="#microcontroller_peripherals" class=header-anchor >Microcontroller Peripherals</a></h1> <h2 id=lecture_video ><a href="#lecture_video" class=header-anchor >Lecture Video</a></h2> <iframe src="https://player.vimeo.com/video/539089494" width=780  height=438  frameborder=0  allowfullscreen></iframe> <h3 id=lecture_handout ><a href="#lecture_handout" class=header-anchor >Lecture Handout</a></h3> <p><a href="/me319/part_i/ME319_-_Mechatronics_-_Part_I_Lecture_4_Microcontroller_Peripherals.pdf">Handout</a></p> <p>Next: <a href="../lecture5/">Part I L5 - GPIO</a> </p> <h3 id=objectives ><a href="#objectives" class=header-anchor >Objectives</a></h3> <ul> <li><p>Give an overview standard microcontroller peripherals</p> <li><p>Become familiar with the STM32Nucleo and its peripherals</p> <li><p>Become familiar with reading a microcontroller datasheet</p> </ul> <h3 id=what_is_a_peripheral ><a href="#what_is_a_peripheral" class=header-anchor >What is a peripheral</a></h3> <p>Remember that a micro-controller is more than just a microprocessor. Subsystems within the micro-controller that are dedicated to a specific functionality are referred to as a peripheral, for example:</p> <ul> <li><p>An MCU communicates with a digital accelerometer through the I2C protocol. <em>It will need an I2C Peripheral</em>.</p> <li><p>An MCU reads an analog temperature sensor, the analog sensor needs to be converted to digital. <em>It will need an ADC Peripheral</em>.</p> <li><p>An MCU needs to keep track of time, count how many seconds have passed between events. <em>It will need a Timer Peripheral</em>.</p> </ul> <p>There can be multiples of the same peripheral on one MCU &#40;e.g. 3 ADC peripherals&#41;</p> <h3 id=microcontroller_architecture ><a href="#microcontroller_architecture" class=header-anchor >Microcontroller Architecture</a></h3> <p>A microcontroller encompasses a CPU core, memory, system clock, power management and a host of peripherals. <center><img src="/me319/part_i/lecture4_media/MCU_ARCH.svg" style="max-width:785px"></center></p> <h3 id=some_common_peripherals ><a href="#some_common_peripherals" class=header-anchor >Some Common Peripherals</a></h3> <p>Here is a list of some common peripherals found on many modern microcontrollers.</p> <ul> <li><p><strong>GPIO</strong>: General Purpose Input Output</p> <ul> <li><p>Basic input-output interface </p> </ul> <li><p><strong>UART</strong>: Universal Asynchronous Receiver Transmitter</p> <ul> <li><p>Serial communication protocol</p> </ul> <li><p><strong>SSI</strong>: Synchronous Serial Interface</p> <ul> <li><p>Serial communication protocol</p> </ul> <li><p><strong>JTAG</strong>: Joint Test Action Group</p> <ul> <li><p>Programming and debugging interface</p> </ul> <li><p><strong>USB</strong>: Universal Serial Bus</p> <ul> <li><p>High Speed Serial Communication</p> </ul> <li><p><strong>ADC</strong>: Analog to Digital Conversion</p> <ul> <li><p>Convert Analog Signals to Digital Values</p> </ul> <li><p><strong>I2C</strong>: Inter-Integrated Communication</p> <ul> <li><p>Serial Communication protocol</p> </ul> <li><p><strong>CAN</strong>: Controlled Area Network</p> <ul> <li><p>Vehicle Communication Standard</p> </ul> <li><p><strong>Timers</strong>: Clocked counters</p> <ul> <li><p>Keep track of time within microcontroller</p> </ul> <li><p><strong>Ethernet</strong>: Network Communication Interface</p> <ul> <li><p>Local Area Network Communication Protocol</p> </ul> <li><p><strong>Analog</strong> Comparators</p> <ul> <li><p>Device that compares two voltages or current and outputs a digital signal</p> </ul> <li><p><strong>PWM</strong>: Pulse Width Modulation</p> <ul> <li><p>A pulsed digital output, used for communication and control of analog devices</p> </ul> </ul> <p>Peripherals have their own processing logic/resources, they don’t compete with the CPU: They don’t <em>share</em> your program execution resources Let’s introduce a few common peripherals at a high level</p> <ol> <li><p>GPIO</p> <li><p>ADC</p> <li><p>UART</p> <li><p>Timers</p> </ol> <p>We will go through each one in a bit more detail later in the course</p> <h3 id=gpio_general_purpose_input-output ><a href="#gpio_general_purpose_input-output" class=header-anchor ><ol> <li><p>GPIO: General Purpose Input-Output</p> </ol> </a></h3> <p>Provides most basic way to interface MCU with the outside world. Things you can do through GPIO &#40;not limited to&#41;:</p> <ul> <li><p>Connect a GPIO pin to a switch and read the state of switch press</p> <li><p>Connect a GPIO pin to an LED and turn the LED on/off</p> <li><p>Connect a GPIO pin to a relay and switch a machine on/off</p> <li><p>Connect to an “interrupt” pin, to register when an external event happened.</p> </ul> <h4 id=example ><a href="#example" class=header-anchor >Example</a></h4> <center><img src="/me319/part_i/lecture4_media/GPIOExampleLEDSwitch.svg" style="max-width:425px"></center> <p>Pin PA1 and PA0 are both configured as GPIO pins. </p> <p>PA1 is read as &quot;Port A Pin 1&quot;, and similarly PA0 is read &quot;Port A Pin 0&quot; PA1 is set as an output pin while PA0 as set as an input pin.</p> <p>When PA1 is set High &#40;Logic 1&#41; the <strong>LED</strong> turns on. And when the switch <strong>SW</strong> is pressed, pin PA0 reads logic 1 &#40;High&#41;. An output pin is <strong>set</strong> and an input pin is <strong>read</strong>. The GPIO Peripheral usually has multiple ports, which have multiple pins.</p> <h3 id=ol_start2_adc_analog-to-digital_convertor ><a href="#ol_start2_adc_analog-to-digital_convertor" class=header-anchor ><ol start=2 > <li><p>ADC: Analog-to-Digital Convertor</p> </ol> </a></h3> <p>An analog signal has an infinite resolution. While a digital signal has finite resolution. An analog signal is continuous: &#40;e.g. temperature sensor, strain-gauge scale&#41; while a digital signal is discrete: &#40;e.g. High/On or Low/Off&#41;</p> <p>The ADC peripheral of a microcontroller helps convert an analog voltage signal to a digital value. </p> <p>The ADC peripheral comes with configurable features, such as:</p> <ul> <li><p>Different resolution settings: ±1mV? ±8mV? ±12mV?</p> <li><p>Number of samples: It can take multiple fast readings and return the average result.</p> <li><p>Range: Adjusting the range to capture the expected signal range can maximize resolution. Is the signal expected to be in the 0-3V range? 0-5V? 0-0.9V? </p> </ul> <h4 id=example__2 ><a href="#example__2" class=header-anchor >Example</a></h4> <p> <center><img src="/me319/part_i/lecture4_media/ADCExampleTempSensor.svg" style="max-width:485px"></center> In this example a temperature sensor is connected to the microcontroller through pin PA2, PA2 is configured as an Analog Input Pin. For example, it can be configured to read the input voltage 10 times ,then take the average of the 10 samples and convert the result into a digital number, then store it in a specific memory location, which is accessible by the program code.</p> <p>The program can check for the latest value &#40;polling&#41;, or the ADC peripheral can be set to notify the program code &#40;via interrupt&#41;, that a new value is ready to be read. </p> <h3 id=ol_start3_uart_universal_asynchronous_receivertransmitter ><a href="#ol_start3_uart_universal_asynchronous_receivertransmitter" class=header-anchor ><ol start=3 > <li><p>UART: Universal Asynchronous Receiver/Transmitter</p> </ol> </a></h3> <p><strong>UART</strong> is one of several communication protocols used on MCUs. It is used for communication between PC and MCU &#40;<em>e.g. Arduino: Serial.print&#40;&#41;</em>&#41;. But an intermediary UART-to-USB is used here. UART is also used for: RF wireless communication, sensors &#40;<em>GPS sensors</em>&#41;, old dial-up modems.</p> <p>Asynchronous means that communication not synchronized between parties. The sender does not have to wait for the received or a broker to manage when to send or when not to send. At a minimum, two lines are required between devices &#40;in addition to power and ground&#41;</p> <ul> <li><p>One Line for Sending &#40;<em>TX: Transmitter</em>&#41;</p> <li><p>One Line for Receiving &#40;<em>RX: Receiver</em>&#41;</p> </ul> <p>Modern MCUs have U<strong>S</strong>ART instead &#40;<em>S: Synchronous, so both async and syn modes are supported</em>&#41;</p> <h4 id=example__3 ><a href="#example__3" class=header-anchor >Example</a></h4> <center><img src="/me319/part_i/lecture4_media/UARTExampleGPS.svg" style="max-width:585px"></center> <p>Here pins PA11 and PA12 are configured for the UART peripheral, PA11 is configured as a transmit &#40;TX&#41; pin and PA12 is receive &#40;RX&#41; pin.</p> <p>The GPS signal receives signals from visible satellites, converts location and time data to a series of characters, then sends this information through its TX pin. Note that the TX pin of the GPS sensor is connected to the RX pin of the MCU. The MCU can perhaps send configuration commands through PA11: TX </p> <h3 id=ol_start4_timers ><a href="#ol_start4_timers" class=header-anchor ><ol start=4 > <li><p>Timers</p> </ol> </a></h3> <p>Timers provide a way to keep track of time &#40;surprise&#33;&#41;. They keep a counter that ticks at a configured rate, this can be used to:</p> <ul> <li><p>Tell the time or elapsed time.</p> <ul> <li><p>E.g. When you call delay&#40;500&#41;; a timer peripheral is used</p> </ul> <li><p>Call a function at a specific and deterministic rate.</p> <ul> <li><p>E.g. Essential in applied control systems</p> </ul> <li><p>Generate a signal with a specific frequency &amp; on/off time ratio</p> <ul> <li><p>E.g. Generate a square wave, PWM or PPM signal</p> </ul> <li><p>Record the time when an external or internal event occurred </p> <ul> <li><p>E.g. Register the frequency of a square wave signal</p> </ul> </ul> <p>We will go through each of these peripherals in more detail in the following lectures and labs.</p> <h3 id=stm32nucleo ><a href="#stm32nucleo" class=header-anchor >STM32Nucleo</a></h3> <p>The following image shows the Morpho header pins on the STM32Nucleo F401RE and some of the alternate functionalities they have, this image is referred to as the <strong>pinout diagram</strong>. Looking at the pinout we notice a few peripherals such as: SPI, GPIO, PWM &#40;TIMER&#41;, I2C, ADC, UART. <center><img src="/me319/part_i/lecture4_media/nucleo64_revc_f401re_mbed_pinout_v3_morpho.png" style="max-width:785px"></center></p> <h3 id=reading_datasheets ><a href="#reading_datasheets" class=header-anchor >Reading Datasheets</a></h3> <p>But how do we know what peripherals are available on a specific MCU? Well, we refer to the datasheet. The microcontroller datasheet contains all the key information about all the bells and whistles that come in the microcontroller. </p> <p>Information such as: speed, memory size, power consumption, electrical ratings, peripherals and their specifications, chip variants and their pins and physical layout, the dimension of the chip for manufacturing purposes, the functionalities of every pin, ordering information and much more.</p> <p>The first or cover page of the datasheet usually contains a summary of the features. An engineer can tell if a certain MCU is suitable or not, just by looking first at the datasheet cover page. </p> <p>Let’s look at the first page of the STM32F401RE microcontroller. STM32F401RE is the MCU on the STM32 Nucleo F401RE board we use in this course. A datasheet is often provided for a sub-family of microcontrollers such as SMT32F401xD/E, where x can stand for different letters/numbers representing different variants. D/E: Includes part numbers that end with D and E</p> <center><img src="/me319/part_i/lecture4_media/STM32F401RE_Datasheet_Page1.svg" style="max-width:785px"></center> <p><a href="/me319/assets/reference_docs/REF01_STM32F401RE_DATASHEET.pdf">STM32F401xE Datasheet</a></p> <p>Next: <a href="../lecture5/">Part I L5 - GPIO</a> </p> <div class=page-foot > <div class=copyright > &copy; Ali AlSaibie, PhD. Last modified: April 29, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div>