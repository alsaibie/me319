<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/me319/libs/highlight/github.min.css"> <link rel=stylesheet  href="/me319/css/franklin.css"> <link rel=stylesheet  href="/me319/css/poole_hyde.css"> <link rel=stylesheet  href="/me319/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 968px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/me319/assets/c.svg"> <title>Lab 7 - Online Digital Filtering</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <br> <img src="/me319/assets/KuwaitUniversityLogoTextLight.svg" style="width: 200px; height: auto; display: inline"> <h1 style="font-size:2em; opacity: 0.75;"><a href="/me319/">ME 319</a></h1> <p class=lead >Mechatronics</p> </div> <script> function hidePart(part_div) { var x = document.getElementById(part_div); if (x.style.display === "none") { x.style.display = "block"; } else { x.style.display = "none"; } } </script> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/me319/">Home</a> <a class="sidebar-nav-item " href="/me319/videos/">Lecture Videos</a> <a class="sidebar-nav-item " href="https://alsaibie.github.io/embedded_ccpp">Embedded C/C++ Mini-Course</a> <a class="sidebar-nav-item " href="/me319/lab_assignments/">Lab Assignments</a> <br> <small style="text-transform: uppercase; font-size: 0.75em">Lab Lessons</small> <div class=part  onclick="hidePart('prelabs_div')">Prelabs</div> <div id=prelabs_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/prelabs/prelab2/"><b>Lab 2</b> - <em>PlatformIO and Arduino</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab3/"><b>Lab 3</b> - <em>Debugging and LL Programming</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab4/"><b>Lab 4</b> - <em>Timers and Interrupts</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab5/"><b>Lab 5</b> - <em>Serial Communication</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab6/"><b>Lab 6</b> - <em>Offline Digital Filtering</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab7/"><b>Lab 7</b> - <em>Online Digital Filtering</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab8/"><b>Lab 8</b> - <em>Motor Dynamics and Control</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab9/"><b>Lab 9</b> - <em>Realtime Motor Control</em></a> </div> <div class=part  onclick="hidePart('addlessons_div')">Additional Lessons</div> <div id=addlessons_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/prelabsextra/lab4extra/"> <b>L4E</b> - <em>Low Level Timers Configuration</em></a> <a class="sidebar-nav-item " href="/me319/prelabsextra/kalmanfilter/"> <b>L6E</b> - <em>Kalman Filter</em></a> </div> <br> <small style="text-transform: uppercase; font-size: 0.75em">Class Lectures</small> <div class=part  onclick="hidePart('part1_div')">I The Brain</div> <div id=part1_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_i/lecture0/"><b>L0</b> - <em>Introduction</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture1/"><b>L1</b> - <em>Microcontroller Architecture</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture2/"><b>L2</b> - <em>Digital Arithmetic</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture3/"><b>L3</b> - <em>Digital Logic</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture4/"><b>L4</b> - <em>Microcontroller Peripherals</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture5/"><b>L5</b> - <em>GPIO</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture6/"><b>L6</b> - <em>Timers</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture7/"><b>L7</b> - <em>Interrupts</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture8/"><b>L8</b> - <em>Communication</em></a> </div> <div class=part  onclick="hidePart('part2_div')">II The Cells</div> <div id=part2_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_ii/lecture1/"><b>L1</b> - <em>Passive Circuits</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture2/"><b>L2</b> - <em>Switching Semiconductors</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture3/"><b>L3</b> - <em>Operational Amplifiers</em></a> </div> <div class=part  onclick="hidePart('part3_div')">III The Senses</div> <div id=part3_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iii/lecture1/"><b>L1</b> - <em>Signal Conditioning and Filtering</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture2/"><b>L2</b> - <em>Sensor Charactersitics</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture3/"><b>L3</b> - <em>Survey of Sensors</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture4/"><b>L4</b> - <em>Motion Sensors</em></a> </div> <div class=part  onclick="hidePart('part4_div')">IV The Muscles</div> <div id=part4_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iv/lecture1/"><b>L1</b> - <em>DC Motors</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture2/"><b>L2</b> - <em>Practical Feedback Control</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture4/"><b>L3</b> - <em>Stepper Motors</em></a> </div> <div class=part  onclick="hidePart('part5_div')">V The Body</div> <div id=part5_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_v/lecture1/"><b>L1</b> - <em>System Integration</em></a> </div> </nav> <p>&copy; Ali AlSaibie, PhD.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=lab_7_-_online_digital_filtering ><a href="#lab_7_-_online_digital_filtering" class=header-anchor >Lab 7 - Online Digital Filtering</a></h1> <p>In this assignment you will be analyzing and applying a digital filter, online. Before attempting this assignment, make sure you go through the <a href="/me319/prelabs/prelab7/">Prelab 7</a> first. </p> <h2 id=tools_required ><a href="#tools_required" class=header-anchor >Tools Required</a></h2> <ul> <li><p>MATLAB v 2016b or higher, with DSP or Signal Processing Toolbox and Control System Toolbox</p> <li><p>Nucleo F401RE</p> <li><p>IKS01A02 Expansion Board</p> </ul> <h2 id=references ><a href="#references" class=header-anchor >References</a></h2> <p>1.	Lab Report Submission Guidelines</p> <h2 id=project_creation_submission ><a href="#project_creation_submission" class=header-anchor >Project Creation &amp; Submission</a></h2> <p>You will work within a single MATLAB Live Script file, add your comments and code within it and submit only a single *.mlx file &#43; a single pdf exported from the Live Script &#40;From Live Editor Tab, click on the save drop down menu and select Export as PDF&#41;.</p> <p>You can also submit a Jupyter notebook &#40;Julia, Python or MATLAB&#41;</p> <h2 id=questions ><a href="#questions" class=header-anchor >Questions</a></h2> <h3 id=i_plot_real-time_data ><a href="#i_plot_real-time_data" class=header-anchor >I. Plot Real-Time Data</a></h3> <p>Using your experience from <a href="/me319/labs/lab5/">Lab 5</a>, setup a JSON serialization to capture the following sensor data and plot them in MATLAB in real-time, on 3 subplots.</p> <ul> <li><p>Accelerometer X and Z axes on one subplot.</p> <li><p>Pressure data in one subplot.</p> <li><p>Preserve the third subplot for the next task.</p> </ul> <h3 id=ii_estimate_pitch_angle ><a href="#ii_estimate_pitch_angle" class=header-anchor >II. Estimate Pitch Angle</a></h3> <p>Use the magnitude of the X and Z of the accelerometer values to estimate the pitch angle of the board. &#40;Hint: <code>atan2&#40;&#41;</code>&#41;. Print the data through the serial terminal and then plot them in real-time on MATLAB, using the MATLAB script from the previous step. Add the pitch angle as a third subplot.</p> <p> <center><img src="/me319/labs/l7assets/image1.png" style="max-width:620px"></center> </p> <h3 id=iii_filter_accelerometer_data ><a href="#iii_filter_accelerometer_data" class=header-anchor >III. Filter Accelerometer Data</a></h3> <p>Log the data of the sensor, as explained in the prelab, while rotating the sensor about the y-axis. Change the number of samples logged according to your needs. Repeat the analysis you did in Lab 6, and apply the following filters </p> <p>1.	A first order Low Pass Filter on the Accelerometer Z-Axis, then</p> <p>2.	A second order Low Pass Filter on the Accelerometer Z-Axis </p> <p>Remember that the filter is a difference equation you apply on the data to be filtered. But unlike in MATLAB, where you loop through all the data to be filtered at once, on the MCU, you apply the difference equation once per new sample, so you only need to store &#40;in variables you create your own&#41; the previous values of the input/output, depending on the filter used.</p> <p>Explain the observed differences between the unfiltered and filtered response, as well the differences between the offline filter performance and the online filter performance. </p> <h3 id=iv_filter_altimeter_data ><a href="#iv_filter_altimeter_data" class=header-anchor >IV. Filter Altimeter Data</a></h3> <p>Log the data of the sensor while moving the board up/down stair-steps &#40;Yes, carry your laptop with you&#41;, and then perform filter design steps in MATLAB similar to previous analyses, then apply a filter of your choice to improve the output data. Test the filter on the board, log the data again &#40;print both the unfiltered and filtered values&#41;, while walking up/down the stairs again and plot the two values. </p> <div class=page-foot > <div class=copyright > &copy; Ali AlSaibie, PhD. Last modified: June 26, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div>