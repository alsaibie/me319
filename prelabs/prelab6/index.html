<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/me319/libs/katex/katex.min.css"> <link rel=stylesheet  href="/me319/libs/highlight/github.min.css"> <link rel=stylesheet  href="/me319/css/franklin.css"> <link rel=stylesheet  href="/me319/css/poole_hyde.css"> <link rel=stylesheet  href="/me319/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 968px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/me319/assets/c.svg"> <title>Prelab 6</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <br> <img src="/me319/assets/KuwaitUniversityLogoTextLight.svg" style="width: 200px; height: auto; display: inline"> <h1 style="font-size:2em; opacity: 0.75;"><a href="/me319/">ME 319</a></h1> <p class=lead >Mechatronics</p> </div> <script> function hidePart(part_div) { var x = document.getElementById(part_div); if (x.style.display === "none") { x.style.display = "block"; } else { x.style.display = "none"; } } </script> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/me319/">Home</a> <a class="sidebar-nav-item " href="/me319/videos/">Lecture Videos</a> <a class="sidebar-nav-item " href="https://alsaibie.github.io/embedded_ccpp">Embedded C/C++ Mini-Course</a> <a class="sidebar-nav-item " href="/me319/lab_assignments/">Lab Assignments</a> <br> <small style="text-transform: uppercase; font-size: 0.75em">Lab Lessons</small> <div class=part  onclick="hidePart('prelabs_div')">Prelabs</div> <div id=prelabs_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/prelabs/prelab2/"><b>Lab 2</b> - <em>PlatformIO and Arduino</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab3/"><b>Lab 3</b> - <em>Debugging and LL Programming</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab4/"><b>Lab 4</b> - <em>Timers and Interrupts</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab5/"><b>Lab 5</b> - <em>Serial Communication</em></a> <a class="sidebar-nav-item active" href="/me319/prelabs/prelab6/"><b>Lab 6</b> - <em>Offline Digital Filtering</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab7/"><b>Lab 7</b> - <em>Online Digital Filtering</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab8/"><b>Lab 8</b> - <em>Motor Dynamics and Control</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab9/"><b>Lab 9</b> - <em>Realtime Motor Control</em></a> </div> <div class=part  onclick="hidePart('addlessons_div')">Additional Lessons</div> <div id=addlessons_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/prelabsextra/lab4extra/"> <b>L4E</b> - <em>Low Level Timers Configuration</em></a> </div> <br> <small style="text-transform: uppercase; font-size: 0.75em">Class Lectures</small> <div class=part  onclick="hidePart('part1_div')">I The Brain</div> <div id=part1_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_i/lecture0/"><b>L0</b> - <em>Introduction</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture1/"><b>L1</b> - <em>Microcontroller Architecture</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture2/"><b>L2</b> - <em>Digital Arithmetic</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture3/"><b>L3</b> - <em>Digital Logic</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture4/"><b>L4</b> - <em>Microcontroller Peripherals</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture5/"><b>L5</b> - <em>GPIO</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture6/"><b>L6</b> - <em>Timers</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture7/"><b>L7</b> - <em>Interrupts</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture8/"><b>L8</b> - <em>Communication</em></a> </div> <div class=part  onclick="hidePart('part2_div')">II The Cells</div> <div id=part2_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_ii/lecture1/"><b>L1</b> - <em>Passive Circuits</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture2/"><b>L2</b> - <em>Switching Semiconductors</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture3/"><b>L3</b> - <em>Operational Amplifiers</em></a> </div> <div class=part  onclick="hidePart('part3_div')">III The Senses</div> <div id=part3_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iii/lecture1/"><b>L1</b> - <em>Signal Conditioning and Filtering</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture2/"><b>L2</b> - <em>Sensor Charactersitics</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture3/"><b>L3</b> - <em>Survey of Sensors</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture4/"><b>L4</b> - <em>Motion Sensors</em></a> </div> <div class=part  onclick="hidePart('part4_div')">IV The Muscles</div> <div id=part4_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iv/lecture1/"><b>L1</b> - <em>DC Motors</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture2/"><b>L2</b> - <em>Practical Feedback Control</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture4/"><b>L3</b> - <em>Stepper Motors</em></a> </div> <div class=part  onclick="hidePart('part5_div')">V The Body</div> <div id=part5_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_v/lecture1/"><b>L1</b> - <em>System Integration</em></a> </div> </nav> <p>&copy; Ali AlSaibie, PhD.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=prelab_6_offline_digital_filtering ><a href="#prelab_6_offline_digital_filtering" class=header-anchor >Prelab 6: Offline Digital Filtering</a></h1> <p>In this prelab we will review the process of analyzing a noisy signal, designing digital filters and implementing them as difference equations. Let&#39;s first create a noisy signal by combining sinusoidal signals of different amplitudes and frequencies, and adding random noise to it.</p> <p> <iframe src="https://player.vimeo.com/video/556846322" width=640  height=360  frameborder=0  allowfullscreen></iframe> <pre><code class="matlab hljs">Fs = <span class=hljs-number >1000</span>;
T = <span class=hljs-number >1</span> / Fs;
L = <span class=hljs-number >1000</span>;
t = (<span class=hljs-number >0</span>:L<span class=hljs-number >-1</span>)*T;
A = <span class=hljs-number >3</span>;
f1 = <span class=hljs-number >5</span>; <span class=hljs-comment >% Hz - Base frequency</span>
<span class=hljs-comment >% Base Signal</span>
OriginalData = A * <span class=hljs-built_in >sin</span>(<span class=hljs-number >2</span>*<span class=hljs-built_in >pi</span>* f1 * t);

<span class=hljs-comment >% Add Higher Frequency Components</span>
NoisyData = OriginalData + <span class=hljs-number >0.2</span>*A*<span class=hljs-built_in >sin</span>(<span class=hljs-number >2</span>*<span class=hljs-built_in >pi</span>*f1*<span class=hljs-number >4</span>*t) +  <span class=hljs-number >0.2</span>*A*<span class=hljs-built_in >sin</span>(<span class=hljs-number >2</span>*<span class=hljs-built_in >pi</span>*f1*<span class=hljs-number >16</span>*t);
<span class=hljs-comment >% Add random noise</span>
NoisyData = NoisyData + <span class=hljs-number >0.25</span>*A*<span class=hljs-built_in >randn</span>(<span class=hljs-number >1</span>, <span class=hljs-built_in >length</span>(t));

<span class=hljs-built_in >figure</span>();
<span class=hljs-built_in >plot</span>(t,OriginalData, <span class=hljs-string >&#x27;LineWidth&#x27;</span>,<span class=hljs-number >3</span>, <span class=hljs-string >&#x27;color&#x27;</span>, <span class=hljs-string >&#x27;k&#x27;</span>); xlabel(<span class=hljs-string >&#x27;Time [s]&#x27;</span>); ylabel(<span class=hljs-string >&#x27;Amplitude&#x27;</span>); grid on; <span class=hljs-built_in >hold</span> on;
<span class=hljs-built_in >plot</span>(t,NoisyData); 
<span class=hljs-built_in >legend</span>(<span class=hljs-string >&#x27;Pure Signal&#x27;</span>, <span class=hljs-string >&#x27;Noisy Signal&#x27;</span>)
<span class=hljs-built_in >hold</span> off;</code></pre></p> <img src="/me319/prelabs/pl6assets/snippet1.svg" alt=""> <p>Let&#39;s decompose the signal and look at its frequency spectrum by using an FFT &#40;Fast Fourier Transform&#41;. We want to observe the strength of the of each frequency component</p> <pre><code class="matlab hljs">y = fft(NoisyData);
L = <span class=hljs-built_in >length</span>(t);
P2 = <span class=hljs-built_in >abs</span>(y/L);
P1 = P2(<span class=hljs-number >1</span>:L/<span class=hljs-number >2</span>+<span class=hljs-number >1</span>);
P1(<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span><span class=hljs-number >-1</span>) = <span class=hljs-number >2</span> * P1(<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span><span class=hljs-number >-1</span>);
f = Fs*(<span class=hljs-number >0</span>:(L/<span class=hljs-number >2</span>))/L;
<span class=hljs-built_in >plot</span>(f(<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>/<span class=hljs-number >2</span>),P1(<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>/<span class=hljs-number >2</span>)); xlabel(<span class=hljs-string >&#x27;Frequency [Hz]&#x27;</span>); ylabel(<span class=hljs-string >&#x27;|P1|&#x27;</span>);</code></pre> <img src="/me319/prelabs/pl6assets/snippet2.svg" alt=""> <p>We can see that we have three main frequency components, as expected, the other ripple is due to the random noise we added. Let&#39;s apply a first order filter first and see if we can remove the noise and higher frequency components. </p> <h3 id=simple_first_order_filter ><a href="#simple_first_order_filter" class=header-anchor >Simple First Order Filter </a></h3> <p>A simple first order low pass filter takes the Laplace form</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>F</mi><mo stretchy=false >(</mo><mi>s</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>s</mi><msub><mi>ω</mi><mi>c</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> F(s) = \dfrac{1}{1+s\omega_c} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=mopen >(</span><span class="mord mathnormal">s</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.1574400000000002em;vertical-align:-0.8360000000000001em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.3139999999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">s</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>And in the discrete Z-domain</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>F</mi><mo stretchy=false >(</mo><msup><mi>z</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo><mo>=</mo><mfrac><mrow><mo stretchy=false >(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=false >)</mo><msup><mi>z</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><mrow><mn>1</mn><mo>−</mo><mi>α</mi><msup><mi>z</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex"> F(z^{-1}) = \dfrac{(1-\alpha)z^{-1}}{1-\alpha z^{-1}} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >(</span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mclose >)</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>It is implemented in a digital form as a difference equation</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>y</mi><mo stretchy=false >[</mo><mi>k</mi><mo stretchy=false >]</mo><mo>=</mo><mo stretchy=false >(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=false >)</mo><mi>x</mi><mo stretchy=false >[</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy=false >]</mo><mo>+</mo><mi>α</mi><mi>y</mi><mo stretchy=false >[</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex"> y[k] = (1-\alpha) x[k-1]+\alpha y[k-1] </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mclose >)</span><span class="mord mathnormal">x</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mclose >]</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><msup><mi>e</mi><mrow><mo>−</mo><mn>2</mn><mi>π</mi><msub><mi>ω</mi><mi>c</mi></msub><msub><mi>T</mi><mi>s</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">\alpha=e^{-2\pi \omega_c T_s} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8413309999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">π</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> <h3 id=bode_plots ><a href="#bode_plots" class=header-anchor >Bode Plots</a></h3> <p>Bode plots are a useful tool for assessing the performance of a signal filter. They are composed of a magnitude and phase diagram. The magnitude diagram gives us the magnitude ratio &#40;gain&#41; between the output and input of the filter at a range of frequencies. While the phase diagram gives us the phase shift of the output signal compared to the input signal.</p> <p>We can convert our filter parameters into transfer functions using the TransferFunction command from scipy.signal, then call the bode function from within the transfer function object.</p> <p><pre><code class="matlab hljs">s = tf(<span class=hljs-string >&#x27;s&#x27;</span>);
wc = [<span class=hljs-number >5</span>, <span class=hljs-number >20</span>, <span class=hljs-number >100</span>];
l= <span class=hljs-built_in >length</span>(wc);
fig = <span class=hljs-built_in >figure</span>();
fig.Position = [<span class=hljs-number >500</span> <span class=hljs-number >400</span> <span class=hljs-number >1920</span> <span class=hljs-number >1080</span>];

<span class=hljs-keyword >for</span> k=<span class=hljs-number >1</span>:l
    <span class=hljs-comment >% Construct the first order continous filter</span>
    H = <span class=hljs-number >1</span> / (s/wc(k) + <span class=hljs-number >1</span>);
    <span class=hljs-comment >% Convert to discrete</span>
    Hz = c2d(H,T)
    <span class=hljs-comment >% Grab the num / den coefficients of the discrete T.F.</span>
    [num,den] = tfdata(Hz, <span class=hljs-string >&#x27;v&#x27;</span>);
    a = num
    b = den
    FilteredData1stOrder = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >1</span>,<span class=hljs-built_in >length</span>(OriginalData));

    <span class=hljs-keyword >for</span> m = <span class=hljs-number >2</span>:<span class=hljs-built_in >length</span>(NoisyData)
        FilteredData1stOrder(m) = - b(<span class=hljs-number >2</span>) * FilteredData1stOrder(m<span class=hljs-number >-1</span>) + a(<span class=hljs-number >2</span>) * NoisyData(m<span class=hljs-number >-1</span>);
    <span class=hljs-keyword >end</span>
    <span class=hljs-comment >%Compute the mean square error between the original signal and the filtered signal</span>
    LpError(k) = immse(OriginalData,FilteredData1stOrder); 
    
    <span class=hljs-comment >%BLOTTING</span>
    subplot(<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,k)
    <span class=hljs-comment >% We&#x27;ll also plot the Bode diagram of the continous filter</span>
    bode(H)
    subplot(<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,k+<span class=hljs-number >3</span>)
    <span class=hljs-built_in >plot</span>(t,NoisyData, <span class=hljs-string >&#x27;Color&#x27;</span>, [<span class=hljs-number >.1</span> <span class=hljs-number >.2</span> <span class=hljs-number >.1</span>], <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >0.5</span>); <span class=hljs-built_in >hold</span> on;
    <span class=hljs-built_in >plot</span>(t,FilteredData1stOrder, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
    <span class=hljs-built_in >plot</span>(t,OriginalData, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
    <span class=hljs-built_in >hold</span> off; 
    <span class=hljs-built_in >legend</span>(<span class=hljs-string >&#x27;Noisy&#x27;</span>, <span class=hljs-string >&#x27;Filtered&#x27;</span>, <span class=hljs-string >&#x27;Original&#x27;</span>);
    xlabel(<span class=hljs-string >&#x27;Time&#x27;</span>);
<span class=hljs-keyword >end</span></code></pre> Output: <pre><code class="plaintext hljs">
Hz =
 
  0.004988
  ---------
  z - 0.995
 
Sample time: 0.001 seconds
Discrete-time transfer function.


a =

         0    0.0050


b =

    1.0000   -0.9950


Hz =
 
    0.0198
  ----------
  z - 0.9802
 
Sample time: 0.001 seconds
Discrete-time transfer function.


a =

         0    0.0198


b =

    1.0000   -0.9802


Hz =
 
   0.09516
  ----------
  z - 0.9048
 
Sample time: 0.001 seconds
Discrete-time transfer function.


a =

         0    0.0952


b =

    1.0000   -0.9048

</code></pre> <img src="/me319/prelabs/pl6assets/snippet3.svg" alt=""></p> <h2 id=butterworth_filter ><a href="#butterworth_filter" class=header-anchor >Butterworth Filter</a></h2> <p>Now let&#39;s try to apply a butterworth filter instead.</p> <p>Butterworth_filter</p> <p>&quot;The Butterworth filter is a type of signal processing filter designed to have a frequency response as flat as possible in the passband&quot; </p> <p>In other words, the Butterworth filter will attempt to retain more of the signal strength &#40;amplitude&#41; in the frequency region desired. Here we chose to use a 2nd order Butterworth filter. It&#39;s transfer function in the z-domain is</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>F</mi><mo stretchy=false >(</mo><msup><mi>z</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo><mo>=</mo><mfrac><mrow><msub><mi>b</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><msup><mi>z</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>b</mi><mn>0</mn></msub><msup><mi>z</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>a</mi><mn>1</mn></msub><msup><mi>z</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>z</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex"> F(z^{-1}) = \dfrac{b_2 + b_1 z^{-1} b_0 z^{-2} }{1-a_1 z^{-1} - a_2 z^{-2}} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.327108em;vertical-align:-0.8360000000000001em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.3139999999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>which gives the difference equation</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>y</mi><mo stretchy=false >[</mo><mi>k</mi><mo stretchy=false >]</mo><mo>=</mo><msub><mi>b</mi><mn>2</mn></msub><mi>x</mi><mo stretchy=false >[</mo><mi>k</mi><mo stretchy=false >]</mo><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi><mo stretchy=false >[</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy=false >]</mo><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mi>x</mi><mo stretchy=false >[</mo><mi>k</mi><mo>−</mo><mn>2</mn><mo stretchy=false >]</mo><mo>−</mo><msub><mi>a</mi><mn>1</mn></msub><mi>y</mi><mo stretchy=false >[</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy=false >]</mo><mo>−</mo><msub><mi>a</mi><mn>2</mn></msub><mi>y</mi><mo stretchy=false >[</mo><mi>k</mi><mo>−</mo><mn>2</mn><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex"> y[k] = b_2 x[k] + b_1 x[k-1] + b_0 x[k-2] - a_1 y[k-1] - a_2 y[k-2] </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >2</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >2</span><span class=mclose >]</span></span></span></span></span> <p><pre><code class="matlab hljs">wc = [<span class=hljs-number >5</span>, <span class=hljs-number >20</span>, <span class=hljs-number >100</span>]; <span class=hljs-comment >%Hz</span>
l= <span class=hljs-built_in >length</span>(wc);
fig = <span class=hljs-built_in >figure</span>();
fig.Position = [<span class=hljs-number >500</span> <span class=hljs-number >400</span> <span class=hljs-number >1920</span> <span class=hljs-number >1080</span>];

<span class=hljs-keyword >for</span> k=<span class=hljs-number >1</span>:l
    <span class=hljs-comment >% The built-in butter function from the signal processing toolbox is</span>
    <span class=hljs-comment >% used</span>
    [numS,denS] = butter(<span class=hljs-number >2</span>, wc(k), <span class=hljs-string >&#x27;low&#x27;</span>, <span class=hljs-string >&#x27;s&#x27;</span>);
    <span class=hljs-comment >% Construct the continous T.F</span>
    H = tf(numS,denS);
    Hz = c2d(H,T)
    [num,den] = tfdata(Hz, <span class=hljs-string >&#x27;v&#x27;</span>);
    
    <span class=hljs-comment >% Apply the filter() - the filter function applies the difference</span>
    <span class=hljs-comment >% equation on the supplied data</span>
    FilteredDataButter = filter(num, den, NoisyData);
    ButterError(k) = immse(OriginalData,FilteredDataButter);
    
    <span class=hljs-comment >%BLOTTING</span>
    subplot(<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,k)
    bode(H)
    subplot(<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,k+<span class=hljs-number >3</span>)
    <span class=hljs-built_in >plot</span>(t,NoisyData, <span class=hljs-string >&#x27;Color&#x27;</span>, [<span class=hljs-number >.1</span> <span class=hljs-number >.2</span> <span class=hljs-number >.1</span>], <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >0.5</span>); <span class=hljs-built_in >hold</span> on;
    <span class=hljs-built_in >plot</span>(t,FilteredDataButter, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
    <span class=hljs-built_in >plot</span>(t,OriginalData, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
    <span class=hljs-built_in >hold</span> off; 
    <span class=hljs-built_in >legend</span>(<span class=hljs-string >&#x27;Noisy&#x27;</span>, <span class=hljs-string >&#x27;Filtered - Butter&#x27;</span>, <span class=hljs-string >&#x27;Pure&#x27;</span>);
    xlabel(<span class=hljs-string >&#x27;Time&#x27;</span>);
<span class=hljs-keyword >end</span></code></pre> Output: <pre><code class="plaintext hljs">
Hz =
 
  1.247e-05 z + 1.244e-05
  -----------------------
   z^2 - 1.993 z + 0.993
 
Sample time: 0.001 seconds
Discrete-time transfer function.


Hz =
 
  0.0001981 z + 0.0001963
  -----------------------
  z^2 - 1.972 z + 0.9721
 
Sample time: 0.001 seconds
Discrete-time transfer function.


Hz =
 
  0.004768 z + 0.004549
  ----------------------
  z^2 - 1.859 z + 0.8681
 
Sample time: 0.001 seconds
Discrete-time transfer function.

</code></pre> <img src="/me319/prelabs/pl6assets/snippet4.svg" alt=""></p> <p>The butterworth filter doesn&#39;t improve the phase delay much. Let&#39;s try a bessel filter <pre><code class="matlab hljs">wc = [<span class=hljs-number >5</span>, <span class=hljs-number >20</span>, <span class=hljs-number >100</span>]; <span class=hljs-comment >%Hz</span>
l= <span class=hljs-built_in >length</span>(wc);
fig = <span class=hljs-built_in >figure</span>();
fig.Position = [<span class=hljs-number >573</span> <span class=hljs-number >438</span> <span class=hljs-number >1500</span> <span class=hljs-number >600</span>];

<span class=hljs-keyword >for</span> k=<span class=hljs-number >1</span>:l
    [numS,denS] = besself(<span class=hljs-number >2</span>, wc(k));
    H = tf(numS,denS);
    Hz = c2d(H,T);
    [num,den] = tfdata(Hz, <span class=hljs-string >&#x27;v&#x27;</span>);
    FilteredDataBessel = filter(num, den, NoisyData);
    BesselError(k) = immse(OriginalData,FilteredDataBessel);
    <span class=hljs-comment >%BLOTTING</span>
    subplot(<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,k)
    bode(H)
    subplot(<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,k+<span class=hljs-number >3</span>)
    <span class=hljs-built_in >plot</span>(t,NoisyData, <span class=hljs-string >&#x27;Color&#x27;</span>, [<span class=hljs-number >.1</span> <span class=hljs-number >.2</span> <span class=hljs-number >.1</span>], <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >0.5</span>); <span class=hljs-built_in >hold</span> on;
    <span class=hljs-built_in >plot</span>(t,FilteredDataBessel, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
    <span class=hljs-built_in >plot</span>(t,OriginalData, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
    <span class=hljs-built_in >hold</span> off; 
    <span class=hljs-built_in >legend</span>( <span class=hljs-string >&#x27;Noisy&#x27;</span>, <span class=hljs-string >&#x27;Filtered&#x27;</span>, <span class=hljs-string >&#x27;Pure&#x27;</span>);
    xlabel(<span class=hljs-string >&#x27;Time&#x27;</span>);
<span class=hljs-keyword >end</span></code></pre> <img src="/me319/prelabs/pl6assets/snippet5.svg" alt=""></p> <p>We can see that a cut-off frequency of 100Hz is required to maintain a decent amplitude response. A a first order low pass filter produces the best phase reponse, and worst filtering. So it is a trade-off between good filtering vs. maintaining phase response. Let&#39;s try to apply a first order low pass filter to maintain a good phase response, but then add two notch filters to attack the higher frequency visible components at f &#61; 4<em>5Hz, 16</em>5Hz <pre><code class="matlab hljs">s = tf(<span class=hljs-string >&#x27;s&#x27;</span>);
wclp = <span class=hljs-number >75</span>; <span class=hljs-comment >%Hz</span>
fig = <span class=hljs-built_in >figure</span>();
fig.Position = [<span class=hljs-number >573</span> <span class=hljs-number >438</span> <span class=hljs-number >1500</span> <span class=hljs-number >600</span>];
Hlp = <span class=hljs-number >1</span> / (s/wclp + <span class=hljs-number >1</span>);
Hzlp = c2d(Hlp,T);
[numN1, denN1] = iirnotch(<span class=hljs-number >4</span>*f1/(<span class=hljs-number >3.15</span>*Fs), <span class=hljs-number >4</span>*f1/(<span class=hljs-number >3.15</span>*Fs)/<span class=hljs-number >35</span>);
HzN1 = tf(numN1,denN1, T);

[numN2, denN2] = iirnotch(<span class=hljs-number >16</span>*f1/(<span class=hljs-number >3.15</span>*Fs), <span class=hljs-number >16</span>*f1/(<span class=hljs-number >3.15</span>*Fs)/<span class=hljs-number >35</span>);
HzN2 = tf(numN2,denN2, T);

HzF = Hzlp * HzN1 * HzN2;
display(HzF)</code></pre> Output: <pre><code class="plaintext hljs">
HzF =
 
  0.07215 z^4 - 0.2881 z^3 + 0.4319 z^2 - 0.2881 z + 0.07215
  ----------------------------------------------------------
  z^5 - 4.918 z^4 + 9.68 z^3 - 9.531 z^2 + 4.694 z - 0.9251
 
Sample time: 0.001 seconds
Discrete-time transfer function.

</code></pre></p> <pre><code class="matlab hljs">[num,den] = tfdata(HzF, <span class=hljs-string >&#x27;v&#x27;</span>);
FilteredDataNotch = filter(num, den, NoisyData);
LpNotchError = immse(OriginalData,FilteredDataNotch);
subplot(<span class=hljs-number >2</span>,<span class=hljs-number >1</span>,<span class=hljs-number >1</span>)
bode(HzF)
subplot(<span class=hljs-number >2</span>,<span class=hljs-number >1</span>,<span class=hljs-number >2</span>)
<span class=hljs-built_in >plot</span>(t,NoisyData, <span class=hljs-string >&#x27;Color&#x27;</span>, [<span class=hljs-number >.1</span> <span class=hljs-number >.2</span> <span class=hljs-number >.1</span>], <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >0.5</span>); <span class=hljs-built_in >hold</span> on;
<span class=hljs-built_in >plot</span>(t,FilteredDataNotch, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
<span class=hljs-built_in >plot</span>(t,OriginalData, <span class=hljs-string >&#x27;LineWidth&#x27;</span>, <span class=hljs-number >2</span>);
<span class=hljs-built_in >hold</span> off; 
<span class=hljs-built_in >legend</span>(<span class=hljs-string >&#x27;Noisy&#x27;</span>, <span class=hljs-string >&#x27;Filtered&#x27;</span>, <span class=hljs-string >&#x27;Pure&#x27;</span> );
xlabel(<span class=hljs-string >&#x27;Time&#x27;</span>);</code></pre> <img src="/me319/prelabs/pl6assets/snippet7.svg" alt=""> <p>Let&#39;s compare the root-mean-square error for each of the different methods tried. <pre><code class="matlab hljs">display(LpError)
display(ButterError)
display(BesselError)
display(LpNotchError)</code></pre> Output: <pre><code class="plaintext hljs">
LpError =

    4.3461    3.1446    0.5460


ButterError =

    4.7315    6.8131    1.0369


BesselError =

    4.7252    6.2031    1.3246


LpNotchError =

    0.7172

</code></pre></p> <div class=page-foot > <div class=copyright > &copy; Ali AlSaibie, PhD. Last modified: June 03, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div>