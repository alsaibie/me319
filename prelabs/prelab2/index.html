<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/me319/libs/highlight/github.min.css"> <link rel=stylesheet  href="/me319/css/franklin.css"> <link rel=stylesheet  href="/me319/css/poole_hyde.css"> <link rel=stylesheet  href="/me319/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 968px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/me319/assets/c.svg"> <title>Prelab 2 - Getting familiar with PlatformIO and Arduino</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <br> <img src="/me319/assets/KuwaitUniversityLogoTextLight.svg" style="width: 200px; height: auto; display: inline"> <h1 style="font-size:2em; opacity: 0.75;"><a href="/me319/">ME 319</a></h1> <p class=lead >Mechatronics</p> </div> <script> function hidePart(part_div) { var x = document.getElementById(part_div); if (x.style.display === "none") { x.style.display = "block"; } else { x.style.display = "none"; } } </script> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/me319/">Home</a> <a class="sidebar-nav-item " href="/me319/videos/">Lecture Videos</a> <a class="sidebar-nav-item " href="https://alsaibie.github.io/embedded_ccpp">Embedded C/C++ Mini-Course</a> <a class="sidebar-nav-item " href="/me319/lab_assignments/">Lab Assignments</a> <br> <small style="text-transform: uppercase; font-size: 0.75em">Lab Lessons</small> <div class=part  onclick="hidePart('prelabs_div')">Prelabs</div> <div id=prelabs_div  style="display:none;"> <a class="sidebar-nav-item active" href="/me319/prelabs/prelab2/"><b>Lab 2</b> - <em>PlatformIO and Arduino</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab3/"><b>Lab 3</b> - <em>Debugging and LL Programming</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab4/"><b>Lab 4</b> - <em>Timers and Interrupts</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab5/"><b>Lab 5</b> - <em>Serial Communication</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab6/"><b>Lab 6</b> - <em>Offline Digital Filtering</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab7/"><b>Lab 7</b> - <em>Online Digital Filtering</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab8/"><b>Lab 8</b> - <em>Motor Dynamics and Control</em></a> <a class="sidebar-nav-item " href="/me319/prelabs/prelab9/"><b>Lab 9</b> - <em>Realtime Motor Control</em></a> </div> <div class=part  onclick="hidePart('addlessons_div')">Additional Lessons</div> <div id=addlessons_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/prelabsextra/lab4extra/"> <b>L4E</b> - <em>Low Level Timers Configuration</em></a> <a class="sidebar-nav-item " href="/me319/prelabsextra/kalmanfilter/"> <b>L6E</b> - <em>Kalman Filter</em></a> </div> <br> <small style="text-transform: uppercase; font-size: 0.75em">Class Lectures</small> <div class=part  onclick="hidePart('part1_div')">I The Brain</div> <div id=part1_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_i/lecture0/"><b>L0</b> - <em>Introduction</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture1/"><b>L1</b> - <em>Microcontroller Architecture</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture2/"><b>L2</b> - <em>Digital Arithmetic</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture3/"><b>L3</b> - <em>Digital Logic</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture4/"><b>L4</b> - <em>Microcontroller Peripherals</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture5/"><b>L5</b> - <em>GPIO</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture6/"><b>L6</b> - <em>Timers</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture7/"><b>L7</b> - <em>Interrupts</em></a> <a class="sidebar-nav-item " href="/me319/part_i/lecture8/"><b>L8</b> - <em>Communication</em></a> </div> <div class=part  onclick="hidePart('part2_div')">II The Cells</div> <div id=part2_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_ii/lecture1/"><b>L1</b> - <em>Passive Circuits</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture2/"><b>L2</b> - <em>Switching Semiconductors</em></a> <a class="sidebar-nav-item " href="/me319/part_ii/lecture3/"><b>L3</b> - <em>Operational Amplifiers</em></a> </div> <div class=part  onclick="hidePart('part3_div')">III The Senses</div> <div id=part3_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iii/lecture1/"><b>L1</b> - <em>Signal Conditioning and Filtering</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture2/"><b>L2</b> - <em>Sensor Charactersitics</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture3/"><b>L3</b> - <em>Survey of Sensors</em></a> <a class="sidebar-nav-item " href="/me319/part_iii/lecture4/"><b>L4</b> - <em>Motion Sensors</em></a> </div> <div class=part  onclick="hidePart('part4_div')">IV The Muscles</div> <div id=part4_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_iv/lecture1/"><b>L1</b> - <em>DC Motors</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture2/"><b>L2</b> - <em>Practical Feedback Control</em></a> <a class="sidebar-nav-item " href="/me319/part_iv/lecture4/"><b>L3</b> - <em>Stepper Motors</em></a> </div> <div class=part  onclick="hidePart('part5_div')">V The Body</div> <div id=part5_div  style="display:none;"> <a class="sidebar-nav-item " href="/me319/part_v/lecture1/"><b>L1</b> - <em>System Integration</em></a> </div> </nav> <p>&copy; Ali AlSaibie, PhD.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=prelab_2_-_getting_familiar_with_platformio_and_arduino ><a href="#prelab_2_-_getting_familiar_with_platformio_and_arduino" class=header-anchor >Prelab 2 - Getting familiar with PlatformIO and Arduino</a></h1> <p>In this prelab, we will go through the steps of creating a new project for the ST Nucleo F401RE board using the Arduino framework. Then we will try a few basic code routines to familiarize ourselves with the Arduino framework. <iframe src="https://player.vimeo.com/video/537200707" width=640  height=360  frameborder=0  allowfullscreen></iframe> </p> <h2 id=configure_a_new_pio_project_for_stm32nucleo ><a href="#configure_a_new_pio_project_for_stm32nucleo" class=header-anchor >Configure a new PIO Project for STM32Nucleo</a></h2> <p>-	Open the PlatformIO tab, if it is not open, click on the bug symbol and double click on Open under PIO Home <center><img src="/me319/prelabs/pl2media/openproject.png" style="max-width:720px"></center> </p> <p>-	On the PlatformIO page, select New Project. Choose a name for your project &#40;e.g. PreLab2&#41;, in the board field, choose the board we are using: if you start typing F401RE you should get : ST Nucleo F401RE, that’s the board we are using. Then, in the framework field, select Arduino. Hit Finish. <center><img src="/me319/prelabs/pl2media/projectwizard.png" style="max-width:720px"></center> </p> <p>A new project will be created, including a template main.cpp file under src folder. </p> <h2 id=blinky ><a href="#blinky" class=header-anchor ><ol> <li><p>Blinky</p> </ol> </a></h2> <p>Let’s try to blink the built-in LED. Copy the below code into main.cpp.</p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;Arduino.h&gt;</span> <span class=hljs-comment >/* This include brings all the arduino magic */</span></span>

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >setup</span><span class=hljs-params >()</span> </span>{ <span class=hljs-comment >/* This function gets called once when the mcu boots up */</span>
<span class=hljs-comment >/* pinMode is an arduino function that sets a pin is input or output */</span>  
  <span class=hljs-built_in >pinMode</span>(LED_BUILTIN, OUTPUT); 
}

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >loop</span><span class=hljs-params >()</span> </span>{ 
<span class=hljs-comment >/* This is an infinite while loop, repeats as long as the mcu is on */</span>  
  <span class=hljs-built_in >digitalWrite</span>(LED_BUILTIN, HIGH);   <span class=hljs-comment >/* Set the STATE of the pin HIGH */</span>
  <span class=hljs-built_in >delay</span>(<span class=hljs-number >500</span>);              <span class=hljs-comment >/* Pause the loop for 500ms = 0.5s */</span>
  <span class=hljs-built_in >digitalWrite</span>(LED_BUILTIN, LOW);     <span class=hljs-comment >/* Set the STATE of the pin LOW */</span>
  <span class=hljs-built_in >delay</span>(<span class=hljs-number >500</span>);
}</code></pre> <p>First test that the code compiles, by clicking on the check button at the status bar. If successful you can now build and flash the code into the microcontroller. <center><img src="/me319/prelabs/pl2media/taskbar.png" style="max-width:420px"></center> </p> <p>Click the arrow button, the code will compile and PIO will attempt to flash the program code into the microcontroller. Ensure that the microcontroller is connected to the PC via USB first. </p> <p>If successful, the built-in led will start to flash at a frequency of 1Hz. Play around with the blinking frequency, reflash and observe what happens.</p> <p>Congratulations, you’ve completed your first microcontroller program. </p> <h2 id=ol_start2_control_the_led_with_the_onboard_switch ><a href="#ol_start2_control_the_led_with_the_onboard_switch" class=header-anchor ><ol start=2 > <li><p>Control the LED with the Onboard Switch</p> </ol> </a></h2> <p>Onboard the NUCLEO board, we have a built-in switch as well. This switch is connected to pin x. We can use this switch to control the state of the LED. Copy over the following code and flash it to the microcontroller. </p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;Arduino.h&gt;</span></span>

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >setup</span><span class=hljs-params >()</span></span>{
  <span class=hljs-built_in >pinMode</span>(LED_BUILTIN, OUTPUT);
  <span class=hljs-comment >/* USER_BTN is a macro for the pin number connected to the switch */</span>
  <span class=hljs-built_in >pinMode</span>(USER_BTN, INPUT); 
}

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >loop</span><span class=hljs-params >()</span></span>{
  <span class=hljs-comment >/* digitalRead() gives us 1 or 0, the button on the Nucleo is connected 
  *  in negative logic (Button Pressed = Low = 0)
  *  We switch the LED on if the button is pressed, turn LED off otherwise
  */</span>
  <span class=hljs-keyword >if</span> (!<span class=hljs-built_in >digitalRead</span>(USER_BTN)){
    <span class=hljs-built_in >digitalWrite</span>(LED_BUILTIN, HIGH);
  }
  <span class=hljs-keyword >else</span>{
    <span class=hljs-built_in >digitalWrite</span>(LED_BUILTIN, LOW);
  }
}</code></pre> <h2 id=ol_start3_transmitting_characters_from_mcu_to_pc ><a href="#ol_start3_transmitting_characters_from_mcu_to_pc" class=header-anchor ><ol start=3 > <li><p>Transmitting Characters from MCU to PC</p> </ol> </a></h2> <p>The Arduino framework has support for the various communication protocols onboard modern microcontrollers, including the UART protocol, which is used to communicate to the PC &#40;by way of USB communication&#41;. Serial is a predeclared class object in the Arduino framework. It holds some neat communication functionalities, including setting speed, sending and receiving. </p> <p>Copy over the following code and flash it to the microcontroller. </p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;Arduino.h&gt;</span></span>

<span class=hljs-type >int</span> counts = <span class=hljs-number >1</span>;
<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >setup</span><span class=hljs-params >()</span></span>{
    <span class=hljs-comment >/* Serial is pre instantiated class object, it holds communication
     * functionalities through the USART periphral, connected over the virtual COM port
     */</span>
    Serial.<span class=hljs-built_in >begin</span>(<span class=hljs-number >9600</span>); <span class=hljs-comment >/* We call begin to enable the peripheral and set the comms speed */</span>
}

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >loop</span><span class=hljs-params >()</span></span>{
    <span class=hljs-built_in >delay</span>(<span class=hljs-number >1000</span>);
    Serial.<span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Hi: &quot;</span>); <span class=hljs-comment >/* We can print strings through the serial object */</span>
    Serial.<span class=hljs-built_in >print</span>(counts); <span class=hljs-comment >/* We can print numbers through the serial object */</span>
    Serial.<span class=hljs-built_in >println</span>(<span class=hljs-string >&quot; Times&quot;</span>); <span class=hljs-comment >/* println adds a &quot;new line&quot; character to the stream */</span>
    counts++;
}</code></pre> <p>Then press on the button with the plug icon to open a serial communication terminal. This terminal connects to the communication port of the microcontroller and prints received output. </p> <h2 id=ol_start4_sending_and_receiving_characters_between_mcu_and_pc ><a href="#ol_start4_sending_and_receiving_characters_between_mcu_and_pc" class=header-anchor ><ol start=4 > <li><p>Sending and Receiving Characters between MCU and PC</p> </ol> </a></h2> <p>You can also send characters through the terminal. Let’s see how you can echo back a character you sent through the terminal. Copy over the following code and flash it into the microcontroller, then open a terminal instance if it is not open already. </p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;Arduino.h&gt;</span></span>

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >setup</span><span class=hljs-params >()</span></span>{
    Serial.<span class=hljs-built_in >begin</span>(<span class=hljs-number >9600</span>);
}

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >loop</span><span class=hljs-params >()</span></span>{
    <span class=hljs-comment >/* Serial.available() returns the number of UNREAD characters in the buffer */</span>
    <span class=hljs-keyword >if</span>(Serial.<span class=hljs-built_in >available</span>() &gt; <span class=hljs-number >0</span> ){
        <span class=hljs-type >char</span> c = Serial.<span class=hljs-built_in >read</span>(); <span class=hljs-comment >/* Reads one character from the buffer */</span>
        Serial.<span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Sent: &quot;</span>); 
        Serial.<span class=hljs-built_in >println</span>(c);<span class=hljs-comment >/* Send back the read character */</span>
    }
}</code></pre> <p>Useful Keyboard Shortcuts for PlatformIO</p> <p>To find all default keyboard binding for PlatformIO on VSCode. Go to File-&gt;Preferences-&gt;Keyboard Shortcuts. Type PlatformIO in the search bar of the keyboard shortcuts tab and you will get a filtered list of the PlatformIO keyboard binding: </p> <ul> <li><p>Build the Program &#40;The check button&#41;: CTRL&#43;ALT&#43;B</p> <li><p>Upload the Program &#40;The arrow button&#41;: CTRL&#43;ALT&#43;U</p> <li><p>Open Serial Terminal &#40;The plug button&#41;: CTRL&#43;ALT&#43;S</p> </ul> <div class=page-foot > <div class=copyright > &copy; Ali AlSaibie, PhD. Last modified: June 26, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div>